# 名片OCR管理系統 產品需求文檔 (PRD) v3.0

## 產品概述
名片OCR管理系統是一個專業的企業級名片數位化管理平台，整合了智能OCR識別、圖像增強、多語言支持等先進技術，為商務人士提供完整的名片管理解決方案。系統採用前後端分離架構，支援移動端與桌面端訪問。

### 核心功能模組
1. **智能掃描與上傳** - 相機掃描 + 圖片上傳雙模式，支援批量處理
2. **OCR智能識別** - 整合OpenAI Vision API，支援中英文混合識別與智能欄位解析
3. **圖像增強處理** - OpenCV智能增強，3倍放大與自動裁剪
4. **資料確認與編輯** - 手動修正與補充，支援中英文對照，即時驗證
5. **名片資料管理** - 搜索、分類、統計分析與健康度檢查
6. **資料匯出** - 多格式匯出(CSV、Excel、vCard)
7. **批量處理** - 批量圖片OCR、Excel/CSV智能匯入

### 技術架構
- **前端**: React 18.2.0 + Antd Mobile 5.28.1 (響應式設計)
- **後端**: FastAPI + Python 3.12+ (異步處理)
- **數據庫**: SQLAlchemy 2.0+ (支援SQLite/PostgreSQL)
- **OCR引擎**: OpenAI Vision API + LLM智能欄位解析
- **圖像處理**: OpenCV 4.8.0 + PIL + 自定義增強算法

---

## 詳細功能需求

### 1. 智能掃描與上傳功能

#### 1.1 啟動掃描工具
**步驟**：
- 用戶通過瀏覽器打開名片掃描網頁
- 首頁顯示掃描工具的介紹，提供「開始掃描」和「名片管理」按鈕
- 系統檢查設備的相機權限，若無授權會請求權限

**預期結果**：啟動掃描界面，準備掃描名片

#### 1.2 相機掃描模式
**步驟**：
- 用戶選擇「掃描名片」進入相機介面
- 相機介面顯示名片輪廓框，引導用戶正確放置
- 系統自動對焦並檢查名片位置，提供即時提示
- 支援手動對焦和閃光燈控制

**技術特性**：
- 智能設備檢測 (移動端/桌面端自適應)
- 多種相機策略支援 (前置/後置攝像頭)
- 實時預覽與位置引導
- 圖像品質自動檢測

**預期結果**：獲得高品質的名片圖像

#### 1.3 圖片上傳模式
**步驟**：
- 用戶選擇「上傳圖片」功能
- 支援拖拽上傳或點擊選擇本地圖片
- 支援JPG、PNG格式，最大10MB
- 系統自動進行圖像預處理

**預期結果**：上傳圖片經過處理後進入OCR識別流程

### 2. OCR智能識別系統

#### 2.1 智能圖像增強
**技術特性**：
- **OpenCV名片檢測**: 自動識別名片邊界並裁剪
- **智能增強服務**: 3倍放大、去噪、對比度優化
- **自適應處理**: 根據圖像質量選擇最佳處理方案
- **批量記憶體管理**: 智能清理防止記憶體溢出

#### 2.2 OCR文字識別
**步驟**：
- 掃描完成後，系統自動開始OCR識別
- 顯示處理進度條和狀態提示
- 提取名片上的中英文文字資料
- 返回結構化JSON格式資料，直接映射到25個標準欄位

**技術實現**：
- 整合OpenAI Vision API進行高精度識別
- 使用結構化提示詞(Structured Prompt)直接獲取JSON格式
- 支援中英文混合內容識別
- 最多3次重試機制，30秒超時保護
- 支援本地OCR API與OpenAI API切換

**預期結果**：名片資料直接轉換為標準JSON格式

#### 2.3 智能欄位解析
**支援欄位** (共25個標準欄位)：

**基本資訊** (8欄位):
- 姓名 (中英文對照)
- 公司名稱 (中英文對照) 
- 職位 (支援多職位，中英文對照)

**組織架構** (6欄位):
- 三級部門結構 (中英文對照)

**聯絡資訊** (5欄位):
- 手機、公司電話1、公司電話2
- Email、Line ID

**地址資訊** (4欄位):
- 公司地址1、公司地址2 (中英文對照)

**備註資訊** (2欄位):
- 備註1、備註2 (可記錄OCR來源等)

### 3. 資料確認與編輯

#### 3.1 智能編輯界面
**步驟**：
- 顯示OCR識別結果，自動填入對應欄位
- 提供中英文欄位對照編輯
- 支援欄位驗證與格式檢查
- 實時儲存草稿避免資料遺失

**編輯特性**：
- 支援清空欄位 (使用空字符串預設值)
- 圖片預覽與OCR原文對照
- 欄位完整度即時檢查
- 批量編輯模式

**預期結果**：用戶確認無誤後，名片資料儲存到系統

#### 3.2 資料品質控制
**健康度檢測**：
- **正常名片**: 姓名、公司、職位/部門、聯絡方式完整
- **問題名片**: 缺少核心資訊，標記需要補充

**驗證規則**：
- 姓名: 中英文任一有值即可
- 公司: 中英文任一有值即可  
- 職位或部門: 至少有一個有值
- 聯絡方式: 手機/電話/Email/Line ID至少一個有值

### 4. 名片資料管理

#### 4.1 資料展示與搜索
**基本功能**：
- 所有名片集中展示在管理頁面
- 支援分頁載入 (避免大量資料載入問題)
- 智能搜索: 支援姓名、公司、職位、聯絡方式模糊搜索
- 多欄位組合搜索

**高級功能**：
- 搜索結果高亮顯示
- 搜索歷史記錄
- 儲存常用搜索條件
- 即時搜索建議

#### 4.2 分類與統計
**分類管理**：
- 依公司名稱自動分組
- 依職位類別分類
- 依聯繫人字母排序
- 自訂分類標籤

**統計分析**：
- 總名片數量統計
- 正常/問題名片比例
- 缺失欄位統計分析
- 月度增長趨勢

#### 4.3 名片健康度儀表板
**視覺化統計**：
- 圓餅圖顯示正常/問題名片比例
- 缺失欄位TOP排行
- 匯入來源統計（OCR/手動/批量）
- 資料品質評分
- 全局統計不受搜索篩選影響

### 5. 資料匯出功能

#### 5.1 多格式匯出
**匯出格式**：
- **CSV格式**: 支援UTF-8編碼，Excel相容
- **Excel格式**: 自動調整列寬，格式化輸出
- **vCard格式**: 標準通訊錄格式，支援行動裝置匯入

**匯出選項**：
- 單筆名片匯出
- 批量選擇匯出
- 全部名片匯出
- 依分類匯出

#### 5.2 匯出資料結構
**標準欄位對應**：
```
姓名, 公司名稱, 職位, 部門1, 手機, 公司電話, 
Email, Line ID, 備註, 公司地址一, 公司地址二
```

**預期結果**：用戶可將名片資料匯出到其他系統使用

### 6. 批量處理功能

#### 6.1 圖片批量匯入
**功能描述**：
- 批量處理指定資料夾下的所有名片圖片
- 支援JPG、PNG格式自動識別
- 智能記憶體管理，防止系統過載
- 即時處理進度顯示

**技術特性**：
- 記憶體使用率監控 (85%閾值保護)
- 批次大小自動調節
- 失敗重試機制
- 處理結果詳細報告

#### 6.2 文本批量匯入
**支援格式**：
- Excel文件 (.xlsx, .xls)
- CSV文件 (UTF-8編碼)
- 最大文件大小: 50MB

**智能匹配**：
- 自動欄位識別與映射
- 支援中英文欄位名稱混合
- 重複資料檢測與跳過
- 缺失欄位智能補強

**匯入流程**：
1. 文件格式驗證
2. 自動欄位映射
3. 資料品質檢查
4. 重複資料檢測
5. 批次資料庫寫入
6. 匯入結果報告

#### 6.3 批量處理統計
**處理報告包含**：
- 總處理檔案數
- 成功處理數量
- 跳過重複數量
- 問題名片數量 (缺失重要欄位)
- 失敗處理數量與錯誤詳情
- 處理時間統計

---

## 技術規格與性能要求

### 系統架構
**前端技術棧**：
- React 18.2.0 + React Router 6.8.0
- Antd Mobile 5.28.1 (移動端優化)
- Axios 1.6.2 (API通訊)
- 響應式設計，支援桌面端與移動端

**後端技術棧**：
- FastAPI (高性能異步框架)
- SQLAlchemy 2.0+ (ORM與資料庫抽象)
- Pydantic 2.0+ (資料驗證)
- OpenCV 4.8.0+ (圖像處理)
- PIL (圖像操作)

### 性能指標
**響應時間**：
- 單張名片OCR處理: < 10秒 (含圖像增強)
- 批量匯入 (100張): < 5分鐘
- 資料庫查詢: < 1秒
- 頁面載入: < 3秒
- API響應: < 500ms

**容量限制**：
- 單張圖片: 最大10MB
- 批量匯入: 最大50MB
- 資料庫: 支援10萬筆名片記錄
- 並發處理: 支援10個同時連線
- 記憶體使用: 85%閾值自動調節批次大小

### 安全與穩定性
**資料安全**：
- API參數驗證與SQL注入防護
- 檔案類型嚴格檢查
- 上傳檔案大小限制
- 敏感資料不記錄到日誌

**系統穩定性**：
- 異常處理與錯誤恢復
- 記憶體洩漏防護
- 資料庫連接池管理
- 自動清理暫存檔案

---

## 用戶體驗設計

### 移動端優化
- 觸控友好的操作介面
- 相機權限智能引導
- 離線模式基本功能
- 網路狀況適應性載入

### 桌面端體驗
- 拖拽上傳支援
- 鍵盤快捷鍵操作
- 大螢幕多欄位展示
- 批量操作優化

### 無障礙設計
- 螢幕閱讀器相容
- 高對比度模式
- 鍵盤導航支援
- 多語言介面支援

---

## 部署與維護

### 環境配置
**開發環境**：
- Node.js 18+ (前端)
- Python 3.12+ (後端)
- SQLite (開發資料庫)
- 端口配置: 前端1002, 後端8006

**生產環境**：
- Docker容器化部署
- PostgreSQL (生產資料庫)
- Nginx反向代理
- 自動備份與監控

**API配置**：
- OCR API: OpenAI Vision API或本地OCR服務
- Batch API: https://local_llm.star-bit.io/api/card

### 維護特性
- 系統健康檢查API
- 詳細的運行日誌
- 錯誤追蹤與報警
- 資料庫自動備份

---

## 結語
本系統提供完整的名片數位化解決方案，從智能識別到資料管理，滿足現代商務環境中的名片管理需求。透過先進的OCR技術與用戶友好的介面設計，大幅提升工作效率與資料品質。